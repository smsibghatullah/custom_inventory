<odoo>
    <record id="action_intercompany_trading_parameter" model="ir.actions.act_window">
            <field name="name">Intercompany Trading Parameters</field>
            <field name="res_model">intercompany.trading.parameter</field>
            <field name="view_mode">tree,form</field>
    </record>

    <!-- Parent Model: IntercompanyParameter Form View -->
        <record id="view_intercompany_trading_parameter_form" model="ir.ui.view">
            <field name="name">intercompany.trading.parameter.form</field>
            <field name="model">intercompany.trading.parameter</field>
            <field name="arch" type="xml">
                <form string="Intercompany Trading Parameters">
                    <sheet>
                        <group string="Source Company">
                            <field name="source_company_id"/>
                            <field name="destination_vendor_id" invisible="1"/>
                        </group>
                        <group col="1">
                            <group string="Destination Sale Order Parameter Companies">
                                <field name="intercompany_sale_destination_company_ids" context="{'default_parameter_type': 'sale'}">
                                    <tree editable="bottom">
                                        <field name="parameter_type" column_invisible="1"/>
                                        <field name="available_sku_category_ids" column_invisible="1" />
                                        <field name="intercompany_source_company_id" column_invisible="1"/>
                                        <field name="destination_company_id" 
                                            domain="[('id', '!=', intercompany_source_company_id)]" />
                                        <field name="destination_vendor_id"/> 
                                        <field name="source_customer_id"/>
                                        <field name="brand_ids" widget="many2many_tags"/>
                                        <field name="category_ids" widget="many2many_tags"/>
                                        <field name="tag_ids" widget="many2many_tags"/>
                                        <field name="tax_id"/>
                                        <!-- <field name="destination_bill_account_id"/>
                                        <field name="destination_invoice_account_id"/> -->
                                    </tree>
                                </field>
                            </group>
                        
                            <group string="Destination Purchase Order Parameter Companies">
                                <field name="intercompany_purchase_destination_company_ids" context="{'default_parameter_type': 'purchase'}">
                                    <tree editable="bottom">
                                        <field name="parameter_type" column_invisible="1"/>
                                        <field name="available_sku_category_ids" column_invisible="1" />
                                        <field name="intercompany_source_company_id" column_invisible="1"/>
                                        <field name="destination_company_id" 
                                            domain="[('id', '!=', intercompany_source_company_id)]" />
                                        <field name="destination_vendor_id" string="Destination Customer"/> 
                                        <field name="source_customer_id" string="Source Vendor"/>
                                        <field name="default_reference" required="1"/>
                                        <field name="default_bci_project_id" required="1"/>
                                        <field name="brand_ids" widget="many2many_tags"/>
                                        <field name="category_ids" widget="many2many_tags"/>
                                        <field name="tag_ids" widget="many2many_tags"/>
                                        <field name="tax_id"/>
                                        <!-- <field name="destination_bill_account_id"/>
                                        <field name="destination_invoice_account_id"/> -->
                                    </tree>
                                </field>
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Parent Model: IntercompanyParameter Tree/List View -->
        <record id="view_intercompany_parameter_tree" model="ir.ui.view">
            <field name="name">intercompany.trading.parameter.tree</field>
            <field name="model">intercompany.trading.parameter</field>
            <field name="arch" type="xml">
                <tree string="Intercompany Trading Parameters">
                    <field name="source_company_id"/>
                    <field name="intercompany_sale_destination_company_ids" widget="many2many_tags"/>
                    <field name="intercompany_purchase_destination_company_ids" widget="many2many_tags"/>
                </tree>
            </field>
        </record>


        <record id="view_sale_order_form_intercompany" model="ir.ui.view">
            <field name="name">sale.order.form.intercompany</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="custom_inventory.view_order_form_inherit_brand"/>
            <field name="arch" type="xml">
                <field name="partner_id" position="after">
                    <field name="allowed_partner_ids" invisible="1"/>
                </field>
                <xpath expr="//field[@name='partner_id']" position="attributes">
                    <attribute name="domain">[('id', 'in', allowed_partner_ids)]</attribute>
                </xpath>
                <xpath expr="//field[@name='brand_id']" position="before">
                    <field name="intercompany" readonly="state == 'sale'"/>
                    <field name="source_company_id" invisible="1"/>
                    <field name="destination_company_id"
                        invisible="intercompany == False" 
                        readonly="intercompany == True"
                        force_save="1"/>
                </xpath>
            </field>
        </record>

        <record id="view_purchase_order_form_intercompany" model="ir.ui.view">
            <field name="name">purchase.order.form.intercompany</field>
            <field name="model">purchase.order</field>
            <field name="inherit_id" ref="custom_inventory.view_purchase_order_form_inherit_brand"/>
            <field name="arch" type="xml">
                <field name="partner_id" position="after">
                    <field name="allowed_partner_ids" invisible="1"/>
                </field>
                <xpath expr="//field[@name='partner_id']" position="attributes">
                    <attribute name="domain">[('id', 'in', allowed_partner_ids)]</attribute>
                </xpath>
                <xpath expr="//field[@name='brand_id']" position="before">
                    <field name="intercompany_trading" readonly="state == 'purchase'"/>
                    <field name="source_company_id" invisible="1"/>
                    <field name="destination_company_id"
                        invisible="intercompany_trading == False" 
                        readonly="intercompany_trading == True"
                        force_save="1"/>
                </xpath>
            </field>
        </record>

        <record id="purchase_rfq" model="ir.actions.act_window">
            <field name="name">Requests for Quotation (Filtered)</field>
            <field name="res_model">purchase.order</field>
            <field name="view_mode">tree,kanban,form,pivot,graph,calendar,activity</field>
            <field name="domain">[('company_id', 'in', context.get('allowed_company_ids'))]</field>
            <field name="search_view_id" ref="purchase.view_purchase_order_filter"/>
            <field name="context">{'quotation_only': True}</field>
            <field name="help" type="html">
              <p class="o_view_nocontent_smiling_face">
                No request for quotation found. Let's create one!
              </p><p>
                Requests for quotation are documents that will be sent to your suppliers to request prices for different products you consider buying.
                Once an agreement has been found with the supplier, they will be confirmed and turned into purchase orders.
              </p>
            </field>
        </record>
</odoo>